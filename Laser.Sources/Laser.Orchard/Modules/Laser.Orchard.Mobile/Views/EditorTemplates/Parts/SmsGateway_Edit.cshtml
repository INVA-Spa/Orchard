@model Laser.Orchard.Mobile.ViewModels.SmsGatewayVM

@{
    Script.Require("LaserOrchardSms").AtHead();
    Script.Require("rcswitcher").AtHead();
    Style.Require("rcswitcher").AtHead();

    bool disabledElements = Model.SmsGateway.SmsMessageSent;
}
@using (Script.Foot()) {
    <script type="text/javascript">

        $(function() {
            $('.rcswitcher-checkbox-sms').rcSwitcher({
                theme: 'flat',
                blobOffset: 1,
                onText: '@T("YES")',
                offText: '@T("NO")'
            }).on({
                'turnon.rcSwitcher': function (e, dataObj) {
                    if (e.target.id == '@Html.FieldIdFor(m => m.SmsGateway.SendToTestNumber)') {
                        $("#test-sms-container").show(400);
                    }
                },
                'turnoff.rcSwitcher': function (e, dataObj) {
                    if (e.target.id == '@Html.FieldIdFor(m => m.SmsGateway.SendToTestNumber)') {
                        $("#test-sms-container").hide(400);
                    }
                }
            });
        });

            $(function() {
                $('.rcswitcher-checkbox-havealias').rcSwitcher({
                    theme: 'flat',
                    blobOffset: 1,
                    onText: '@T("YES")',
                    offText: '@T("NO")'
                }).on({
                    'turnon.rcSwitcher': function (e, dataObj) {
                        if (e.target.id == '@Html.FieldIdFor(m => m.SmsGateway.HaveAlias)') {
                        $("#alias-sms-container").show(400);
                    }
                },
                'turnoff.rcSwitcher': function (e, dataObj) {
                    if (e.target.id == '@Html.FieldIdFor(m => m.SmsGateway.HaveAlias)') {
                        $("#alias-sms-container").hide(400);
                    }
                }
            });
            });

            $(function() {
                $('#txtTesto').on('focus blur keypress keyup change paste', {
                    maxLength: '@Model.MaxLenghtSms',
                    txtTesto: $('#txtTesto'),
                    lblnumeroMessaggi: $('#lblnumeroMessaggi'),
                    lblnumeroChar: $('#lblnumeroChar')
                }, ControllaMessaggio);
            });

    </script>
}

<div id="sms-comm-container" class="comm-tabbed">

    <div>
        <label for="contChar">@T("Number of chars:")</label>
        <span style="margin-left: 20px; font-weight: bold">@Html.Label("contChar", "0", new { @id = "lblnumeroChar" })</span>
    </div>
    <div>
        <label for="contMessage">@T("Number of messages:")</label>
        <span style="margin-left: 20px; font-weight: bold">@Html.Label("contMessage", "0", new { @id = "lblnumeroMessaggi" })</span>
    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.SmsGateway.Message, new { @class = "control-label col-md-2" })
        <div class="col-md-10">
            @Html.TextAreaFor(model => model.SmsGateway.Message, new { @id = "txtTesto", @class = "text large" })
            @Html.ValidationMessageFor(model => model.SmsGateway.Message)
        </div>
    </div>

    <button type="submit" name="submit.nomePH" id="btnPHNome" onclick="$('#txtTesto').insertAtCaret('[PH_' + $(this).text().toUpperCase() + ']');return false;">@T("Name")</button>
    <button type="submit" name="submit.cognomePH" id="btnPHCognome" onclick="$('#txtTesto').insertAtCaret('[PH_' + $(this).text().toUpperCase() + ']');return false;">@T("Surname")</button>

    <div>
        @Html.LabelFor(m => m.SmsGateway.HaveAlias, T("Have Alias").Text, new { @class = "forcheckbox" })
        @Html.CheckBoxFor(model => model.SmsGateway.HaveAlias, new { @class = "rcswitcher-checkbox-havealias" })
    </div>

    <div id="alias-sms-container" style="@((!Model.SmsGateway.HaveAlias) ? "display:none;" : "")">
        @Html.LabelFor(m => m.SmsGateway.Alias, T("Alias").Text, new { @class = "forcheckbox" })
        @Html.DropDownListFor(model => model.SmsGateway.Alias, new SelectList(Model.AliasList, Model.SmsGateway.Alias))
    </div>

    <div>
        @Html.LabelFor(m => m.SmsGateway.SendToTestNumber, T("Send for test").Text, new { @class = "forcheckbox" })
        @Html.CheckBoxFor(model => model.SmsGateway.SendToTestNumber, new { @class = "rcswitcher-checkbox-sms" })
    </div>

    <div id="test-sms-container" style="@((!Model.SmsGateway.SendToTestNumber) ? "display:none;" : "")">
        @Html.LabelFor(m => m.SmsGateway.NumberForTest, T("Test Sms number").Text, new { @class = "forcheckbox" })
        @Html.TextBoxFor(model => model.SmsGateway.NumberForTest, new { @class = "text medium" })
        <button type="submit" name="submit.Test" value="submit.SmsTest">@T("Send for test")</button>
    </div>

    <div>
        @Html.LabelFor(m => m.SmsGateway.SendOnNextPublish, T("Send on next publish").Text, new { @class = "forcheckbox" })
        @if (!disabledElements) { 
            @Html.CheckBoxFor(model => model.SmsGateway.SendOnNextPublish, new { @class = "rcswitcher-checkbox-mail" }) 
            <i class="fa fa-times-circle" style="color: red"></i> @T("SMS not yet sent.")
        } else {
            @Html.CheckBoxFor(model => model.SmsGateway.SendOnNextPublish, new { @class = "rcswitcher-checkbox-mail", @disabled = "disabled" }) 
            <i class="fa fa-check-circle" style="color: green"></i> @T("SMS already sent.")
        }
        @if (disabledElements) { 
            <div class="message message-Error">@T("This SMS has been already sent. You will be able to edit and save it, but it will not be sent anymore on next publish.")</div>
        }
    </div>

</div>

<div class="tab-folder">
    <a href="#sms-comm-container"><i class="fa fa-phone"></i>@T("Sms")</a>
</div>
