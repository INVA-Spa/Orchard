@using Orchard.ContentManagement
@using Orchard.MediaLibrary.Fields
@using Orchard.Utility.Extensions
@{
    var _contentManager = WorkContext.Resolve<IContentManager>();
    Model.Classes.Add("content-item");

    var contentTypeClassName = ((string)Model.ContentItem.ContentType).HtmlClassify();
    Model.Classes.Add(contentTypeClassName);

    var tag = Tag(Model, "article");

    var contentItem = (ContentItem)Model.ContentItem;
    var title = _contentManager.GetItemMetadata(contentItem).DisplayText;
    var productImageField = (contentItem.Parts
        .SelectMany(pa => pa.Fields)
        .Where(fi => fi is MediaLibraryPickerField && fi.Name == "ProductImage")
        .FirstOrDefault() as MediaLibraryPickerField);
    var productImages = productImageField == null ? null : productImageField.MediaParts;

}
@tag.StartElement

<div class="col-md-4 agileinfo_new_products_grid agileinfo_new_products_grid_products">
    <div class="agile_ecommerce_tab_left products_grid">
        @if (productImages != null && productImages.Any()) {
            <div class="hs-wrapper hs-wrapper2">
                @foreach (var imageUrl in productImages.Select(mp => mp.MediaUrl)) {
                    <img src="@Display.ResizeMediaUrl(Width: 223, Height: 298, Mode: "pad", Alignment: "middlecenter", Path: imageUrl)" alt=" " class="img-responsive" />
                }
            </div>
        }
        <h5><a href="@Url.ItemDisplayUrl(contentItem)">@title</a></h5>
        <div class="simpleCart_shelfItem">
            @Display(Model.Content)
        </div>
        @*<div class="products_grid_pos">
            <h6>New</h6>
        </div>*@
    </div>
</div>

@tag.EndElement
