@model LocalizationTaxonomiesViewModel
@using Orchard.Taxonomies.ViewModels;
@{
    Script.Require("jQuery");
}


@using (Script.Foot()) {
    <script type="text/javascript">
        //<![CDATA[
        $(document).ready(function () {
                @{
                    var Taxonomyprefix = ((ViewData)).TemplateInfo.HtmlFieldPrefix.Replace('.','_');
                }
            // $("#@Html.IdFor(m => m.SelectedCulture)").insertAfter(".taxonomy-wrapper[data-id-prefix='@Taxonomyprefix']");

            var pageurl = '@Url.Action("GetTaxonomy", "LocalizationTaxonomy", new { area = "Orchard.Taxonomies" })';
            function filterTaxonomyCulture(culture) {
                $.ajax({
                    url: pageurl,
                    data: { contentTypeName: '@Model.ContentType', taxonomyFieldName: '@Model.FieldName', contentId: @Model.Id, culture: culture },
                    success: function (html) {
                        $(".taxonomy-wrapper[data-id-prefix='@Taxonomyprefix']").replaceWith(html);
                        $(".taxonomy-wrapper[data-id-prefix='@Taxonomyprefix'] legend").expandoControl(function (controller) { return controller.nextAll(".expando"); }, { collapse: true, remember: false });
                    }
                }).fail(function () {
                    alert("@T("Loading taxonomy fail, Retry")");
                });
            }

            $("#Localization_SelectedCulture").on('change', function () {
                var optionSelected = $("option:selected", this);
                filterTaxonomyCulture($("#Localization_SelectedCulture").val());
            });
            $("#Localization_SelectedCulture").trigger("change");
        });
        //]]>
    </script>
    }